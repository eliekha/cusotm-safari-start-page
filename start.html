<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>New Tab</title>
<link rel="stylesheet" href="css/styles.css">
<style>@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}</style>
</head>
<body>
<div class="c">
<div class="logo" id="logo"><img src="" alt=""></div>
<div class="g" id="g">Good afternoon</div>
<div class="t" id="t">12<span class="ts">:</span>00</div>
<div class="dt" id="d">Wednesday, January 28</div>
<div class="sc" id="sc">
<input type="text" class="si" id="s" placeholder="Search Google or your history...  âŒ˜/ for AI" autocomplete="off" autofocus>
<div class="sg" id="r"></div>
</div>
<div class="ql" id="ql"></div>
<div class="cal-container" id="cal-container">
<div class="cal-in-call" id="cal-in-call" style="display:none" onclick="toggleCalendarExpand()">
<div class="cal-in-call-info">
<div class="cal-in-call-dot"></div>
<div class="cal-in-call-text">In call: <strong id="cal-current-title"></strong></div>
</div>
<div class="cal-in-call-toggle"><span class="cal-upcoming-badge" id="cal-upcoming-count"></span><svg class="cal-chevron" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg></div>
</div>
<div class="cal-events" id="cal-events"></div>
</div>
<!-- Hub: Meeting Prep (Right Side) -->
<div class="hub-prep-container minimized">
<div class="day-tabs" id="day-tabs" style="display:none"></div>
<div class="hub-section collapsed" id="hub-prep" style="display:none">
<div class="hub-collapsed-badge" id="hub-prep-collapsed-badge"></div>
<div class="hub-header" onclick="toggleHubSection('prep')">
<div class="hub-header-left">
<div class="hub-header-icon prep"><svg viewBox="0 0 24 24"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" fill="#4285f4"/></svg></div>
<div class="hub-header-info">
<div class="hub-header-title">Meeting Prep</div>
<div class="hub-header-subtitle" id="hub-prep-subtitle">Get ready for your next call</div>
</div>
</div>
<div class="hub-header-right">
<div class="meeting-nav" id="meeting-nav">
<button class="meeting-nav-btn" id="meeting-prev" onclick="event.stopPropagation();navigateMeeting(-1)" title="Previous meeting"><svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg></button>
<span class="meeting-nav-indicator" id="meeting-nav-indicator">1/1</span>
<button class="meeting-nav-btn" id="meeting-next" onclick="event.stopPropagation();navigateMeeting(1)" title="Next meeting"><svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg></button>
</div>
<div class="hub-header-badge" id="hub-prep-badge"></div>
<div class="hub-toggle"><svg viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg></div>
</div>
</div>
<div class="hub-content" id="hub-prep-content"></div>
</div>
</div>
</div>

<button class="edit-btn" id="edit-btn" onclick="openModal()" title="Customize">
<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
</button>

<!-- AI Search Overlay -->
<div class="ai-search-overlay" id="ai-search-overlay">
<div class="ai-search-backdrop" onclick="closeAISearch()"></div>
<div class="ai-search-panel" id="ai-search-panel">
<div class="ai-search-header">
<div class="ai-search-icon">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
</div>
<input type="text" class="ai-search-input" id="ai-search-input" placeholder="Ask anything about your work..." autocomplete="off">
<kbd class="ai-search-esc">esc</kbd>
</div>
<div class="ai-search-sources" id="ai-search-sources">
<span class="ai-sources-label">Search in:</span>
<button class="ai-source-pill active" data-source="slack" onclick="toggleAISource('slack')"><span class="ai-source-dot"></span>Slack</button>
<button class="ai-source-pill active" data-source="jira" onclick="toggleAISource('jira')"><span class="ai-source-dot"></span>Jira</button>
<button class="ai-source-pill active" data-source="confluence" onclick="toggleAISource('confluence')"><span class="ai-source-dot"></span>Confluence</button>
<button class="ai-source-pill active" data-source="gmail" onclick="toggleAISource('gmail')"><span class="ai-source-dot"></span>Gmail</button>
<button class="ai-source-pill active" data-source="drive" onclick="toggleAISource('drive')"><span class="ai-source-dot"></span>Drive</button>
</div>
<div class="ai-search-results" id="ai-search-results">
<div class="ai-search-empty">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
<span>Ask a question to search across your connected tools</span>
</div>
</div>
</div>
</div>

<!-- AI Chat Button and Panel -->
<svg style="display:none">
<defs>
<linearGradient id="ai-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
<stop offset="0%" style="stop-color:#3b82f6"/>
<stop offset="100%" style="stop-color:#1d4ed8"/>
</linearGradient>
</defs>
</svg>

<div class="modal" id="modal">
<div class="modal-backdrop" onclick="closeModal()"></div>
<div class="modal-content">
<div class="sheet-header">
<h2>Settings</h2>
<button class="sheet-close" onclick="closeModal()"><svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button>
</div>
<div class="settings-tabs">
<button class="settings-tab active" data-tab="general" onclick="switchSettingsTab('general')">General</button>
<button class="settings-tab" data-tab="appearance" onclick="switchSettingsTab('appearance')">Appearance</button>
<button class="settings-tab" data-tab="hub" onclick="switchSettingsTab('hub')">Hub</button>
<button class="settings-tab" data-tab="status" onclick="switchSettingsTab('status');fetchServiceHealth();fetchPrefetchStatus()">Status</button>
<button class="settings-tab" data-tab="prompts" onclick="switchSettingsTab('prompts');loadPrompts()">Prompts</button>
</div>

<div id="settings-general" class="settings-panel active">
<div class="modal-section">
<label>Logo</label>
<div class="logo-upload">
<div class="logo-preview" id="logo-preview">
<svg viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
</div>
<div class="logo-btns">
<div class="logo-btn" onclick="document.getElementById('logo-file').click()">Upload logo</div>
<input type="file" id="logo-file" accept="image/*" onchange="handleLogoUpload(this)">
<button class="logo-clear" onclick="clearLogo()">Remove</button>
</div>
</div>
</div>
<div class="modal-section">
<label>Your Name</label>
<input type="text" id="edit-name" placeholder="Enter your name">
</div>
<div class="modal-section">
<label>Calendar</label>
<div class="cal-toggle">
<input type="checkbox" id="cal-enabled" onchange="toggleCalendar()">
<span style="color:rgba(255,255,255,.7);font-size:13px">Show next meeting</span>
<span style="color:rgba(255,255,255,.35);font-size:11px;margin-left:8px">(Google Calendar)</span>
</div>
<div id="cal-settings-fields" style="display:none">
<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
<span style="color:rgba(255,255,255,.5);font-size:12px">Show events within</span>
<input type="number" id="cal-minutes" value="60" min="15" max="480" style="width:70px;padding:8px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);border-radius:6px;color:#fff;font-size:13px">
<span style="color:rgba(255,255,255,.5);font-size:12px">minutes</span>
</div>
</div>
</div>
<div class="modal-section">
<label>Quick Links</label>
<div id="links-container"></div>
<button class="add-link" onclick="addLink()">+ Add Link</button>
</div>
</div>

<div id="settings-appearance" class="settings-panel">
<div class="modal-section">
<label>Background</label>
<div class="bg-presets" id="bg-presets"></div>
<div class="bg-gradient-maker">
<div class="color-picker">
<input type="color" id="color1" value="#1a1a2e" onchange="updateGradientPreview()">
<label>Start</label>
</div>
<div class="gradient-preview" id="gradient-preview"></div>
<div class="color-picker">
<input type="color" id="color2" value="#0f3460" onchange="updateGradientPreview()">
<label>End</label>
</div>
<button class="gradient-apply" onclick="applyCustomGradient()">Apply</button>
</div>
<div class="bg-custom">
<div class="bg-upload" onclick="document.getElementById('bg-file').click()">Upload image...</div>
<input type="file" id="bg-file" accept="image/*" onchange="handleBgUpload(this)">
<button class="bg-clear" onclick="clearBg()">Reset</button>
</div>
</div>
<div class="modal-section">
<label>UI Style</label>
<div class="theme-toggle">
<button class="theme-btn dark" id="theme-dark" onclick="setTheme('dark')">
<div class="theme-preview"></div>
<span>Dark</span>
</button>
<button class="theme-btn light" id="theme-light" onclick="setTheme('light')">
<div class="theme-preview"></div>
<span>Light</span>
</button>
</div>
</div>
</div>

<div id="settings-hub" class="settings-panel">
<div class="modal-section">
<div style="display:flex;align-items:flex-start;gap:12px;padding:14px;background:rgba(255,255,255,.04);border-radius:10px;margin-bottom:16px">
<input type="checkbox" id="hub-enabled" onchange="toggleHubSettings()" style="width:18px;height:18px;margin-top:2px;flex-shrink:0">
<div style="flex:1">
<div style="font-size:14px;color:rgba(255,255,255,.9)">Enable Meeting Prep</div>
<div style="font-size:12px;color:rgba(255,255,255,.5);margin-top:4px">Show contextual data for upcoming meetings</div>
</div>
</div>
<div id="hub-sources-container">
<div style="font-size:11px;color:rgba(255,255,255,.4);text-transform:uppercase;letter-spacing:.5px;margin:16px 0 8px 0">Data Sources</div>
<div class="hub-sources" id="hub-sources">
<div class="hub-source">
<input type="checkbox" id="hub-ai-brief" checked>
<div class="hub-source-info"><span class="hub-source-name">AI Brief</span></div>
<span class="hub-source-status available">Available</span>
</div>
<div class="hub-source">
<input type="checkbox" id="hub-jira" checked>
<div class="hub-source-info"><span class="hub-source-name">Jira</span></div>
<span class="hub-source-status" id="hub-jira-status">Checking...</span>
</div>
<div class="hub-source">
<input type="checkbox" id="hub-confluence" checked>
<div class="hub-source-info"><span class="hub-source-name">Confluence</span></div>
<span class="hub-source-status" id="hub-confluence-status">Checking...</span>
</div>
<div class="hub-source">
<input type="checkbox" id="hub-slack" checked>
<div class="hub-source-info"><span class="hub-source-name">Slack</span></div>
<span class="hub-source-status" id="hub-slack-status">Checking...</span>
</div>
<div class="hub-source">
<input type="checkbox" id="hub-gmail" checked>
<div class="hub-source-info"><span class="hub-source-name">Gmail</span></div>
<span class="hub-source-status" id="hub-gmail-status">Checking...</span>
</div>
<div class="hub-source">
<input type="checkbox" id="hub-drive" checked>
<div class="hub-source-info"><span class="hub-source-name">Google Drive</span></div>
<span class="hub-source-status available">Available</span>
</div>
</div>
<div class="hub-setup-hint" id="hub-setup-hint" style="display:none"></div>
<div style="font-size:11px;color:rgba(255,255,255,.4);text-transform:uppercase;letter-spacing:.5px;margin:20px 0 8px 0">AI Model</div>
<div style="display:flex;align-items:center;gap:12px">
<select id="hub-model" onchange="updateHubModel()" style="flex:1;padding:10px 12px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);border-radius:8px;color:#fff;font-size:13px;cursor:pointer">
<optgroup label="Fast (Recommended)">
<option value="anthropic-claude-4-5-haiku" selected>Claude 4.5 Haiku (Default)</option>
<option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
<option value="gemini-2.5-flash-preview">Gemini 2.5 Flash</option>
<option value="grok-4-1-fast-non-reasoning">Grok 4.1 Fast</option>
</optgroup>
<optgroup label="Balanced">
<option value="anthropic-claude-4-5-sonnet">Claude 4.5 Sonnet</option>
<option value="anthropic-claude-4-sonnet">Claude 4 Sonnet</option>
<option value="anthropic-claude-3-7-sonnet">Claude 3.7 Sonnet</option>
<option value="gemini-2.5-preview">Gemini 2.5 Pro</option>
</optgroup>
<optgroup label="Best Quality">
<option value="claude-opus-4-5">Claude Opus 4.5</option>
<option value="gemini-3-pro">Gemini 3 Pro</option>
<option value="grok-4">Grok 4</option>
</optgroup>
</select>
</div>
<div style="font-size:11px;color:rgba(255,255,255,.35);margin-top:8px">Used for AI Brief and data source searches</div>
</div>
</div>
</div>

<div id="settings-status" class="settings-panel">
<div class="modal-section">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
<span style="font-size:14px;color:rgba(255,255,255,.9)">Service Health</span>
<button onclick="fetchServiceHealth()" style="padding:6px 12px;background:rgba(255,255,255,.1);border:none;border-radius:6px;color:rgba(255,255,255,.8);cursor:pointer;font-size:12px">Refresh</button>
</div>
<div id="service-health-container" style="display:flex;flex-direction:column;gap:8px;margin-bottom:20px">
<div style="font-size:12px;color:rgba(255,255,255,.4);text-align:center;padding:12px">Loading...</div>
</div>
</div>
<div class="modal-section">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
<span style="font-size:14px;color:rgba(255,255,255,.9)">Prefetch Activity</span>
<button id="status-refresh-btn" onclick="fetchPrefetchStatus()" style="padding:6px 12px;background:rgba(255,255,255,.1);border:none;border-radius:6px;color:rgba(255,255,255,.8);cursor:pointer;font-size:12px">Refresh</button>
</div>
<div id="prefetch-status-current" style="padding:12px;background:rgba(255,255,255,.04);border-radius:8px;margin-bottom:12px">
<div style="font-size:12px;color:rgba(255,255,255,.5)">Loading...</div>
</div>
<div style="font-size:13px;color:rgba(255,255,255,.7);margin-bottom:8px">Activity Log</div>
<div id="prefetch-activity-log" style="max-height:300px;overflow-y:auto;background:rgba(0,0,0,.2);border-radius:8px;padding:8px">
<div style="font-size:12px;color:rgba(255,255,255,.4);text-align:center;padding:20px">Click Refresh to load activity</div>
</div>
</div>
</div>

<div id="settings-prompts" class="settings-panel">
<div class="modal-section">
<div style="margin-bottom:12px">
<span style="font-size:14px;color:rgba(255,255,255,.9)">Customize AI Prompts</span>
</div>
<div style="font-size:11px;color:rgba(255,255,255,.4);margin-bottom:16px">
Customize prompts for each data source. Variables: <code style="background:rgba(255,255,255,.1);padding:2px 4px;border-radius:3px">{title}</code> <code style="background:rgba(255,255,255,.1);padding:2px 4px;border-radius:3px">{attendees}</code> <code style="background:rgba(255,255,255,.1);padding:2px 4px;border-radius:3px">{description}</code> <code style="background:rgba(255,255,255,.1);padding:2px 4px;border-radius:3px">{limit}</code> <code style="background:rgba(255,255,255,.1);padding:2px 4px;border-radius:3px">{emails}</code>
</div>
<div id="prompts-container" style="display:flex;flex-direction:column;gap:16px">
<div style="font-size:12px;color:rgba(255,255,255,.5);text-align:center;padding:20px">Loading prompts...</div>
</div>
</div>
</div>

<div class="btn-row">
<button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
<button class="btn btn-primary" onclick="saveSettings()">Save</button>
</div>
</div>
</div>


<script src="js/app.js"></script>
<script src="js/hub.js"></script>
</body>
</html>
