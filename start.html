<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>New Tab</title>
<style>
:root{
--text-primary:rgba(255,255,255,.9);
--text-secondary:rgba(255,255,255,.7);
--text-muted:rgba(255,255,255,.5);
--text-greeting:rgba(255,255,255,.8);
--text-time:#fff;
--text-date:rgba(255,255,255,.5);
--bg-card:rgba(0,0,0,.3);
--bg-card-hover:rgba(255,255,255,.1);
--border-color:rgba(255,255,255,.15);
--border-hover:rgba(255,255,255,.25);
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{font-family:-apple-system,BlinkMacSystemFont,system-ui,sans-serif;display:flex;align-items:center;justify-content:center;padding:20px;background:#1a1a2e;background-size:cover;background-position:center}
.c{width:100%;max-width:600px;text-align:center}
.g{font-size:24px;font-weight:300;margin-bottom:6px;letter-spacing:-.3px;color:var(--text-greeting)}
.t{font-size:72px;font-weight:100;letter-spacing:-4px;line-height:1;margin-bottom:4px;color:var(--text-time)}
.ts{animation:b 1s ease-in-out infinite}
@keyframes b{0%,45%{opacity:1}50%,100%{opacity:.3}}
.dt{font-size:14px;font-weight:400;margin-bottom:28px;letter-spacing:.3px;color:var(--text-date)}
.sc{position:relative;width:100%;max-width:500px;margin:0 auto 24px;background:var(--bg-card);border-radius:12px;border:1px solid var(--border-color);overflow:hidden;transition:all .2s;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px)}
.sc:focus-within{background:var(--bg-card-hover);border-color:var(--border-hover)}
.si{width:100%;padding:16px 20px;font-size:16px;border:none;background:transparent;color:var(--text-primary);outline:none}
.si::placeholder{color:var(--text-muted)}
.sg{max-height:0;opacity:0;overflow:hidden;transition:max-height .25s ease,opacity .2s ease,padding .2s ease;background:var(--bg-card)}
.sg.a{max-height:350px;opacity:1;border-top:1px solid var(--border-color);padding:6px 0;overflow-y:auto}
.su{display:flex;align-items:center;padding:10px 20px;cursor:pointer;color:var(--text-primary);text-decoration:none;transition:background .15s ease;opacity:0;transform:translateY(-8px);animation:fadeIn .2s ease forwards}
.su:nth-child(1){animation-delay:0s}.su:nth-child(2){animation-delay:.03s}.su:nth-child(3){animation-delay:.06s}.su:nth-child(4){animation-delay:.09s}.su:nth-child(5){animation-delay:.12s}.su:nth-child(6){animation-delay:.15s}.su:nth-child(7){animation-delay:.18s}.su:nth-child(8){animation-delay:.21s}
@keyframes fadeIn{to{opacity:1;transform:translateY(0)}}
.su:hover,.su.sl{background:var(--bg-card-hover)}
.sui{width:18px;height:18px;margin-right:12px;flex-shrink:0;fill:var(--text-muted)}
.sut{font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;margin-right:10px;text-align:left;color:var(--text-primary)}
.suy{font-size:9px;text-transform:uppercase;letter-spacing:.6px;font-weight:500;padding:3px 6px;border-radius:3px;color:var(--text-muted);background:var(--bg-card)}
.sug .suy{background:rgba(100,150,255,.2);color:rgba(130,170,255,.9)}
.suv{font-size:9px;color:var(--text-muted);margin-left:8px}
.ql{display:flex;flex-wrap:wrap;justify-content:center;gap:10px}
.q{display:flex;align-items:center;gap:6px;padding:10px 16px;background:var(--bg-card);color:var(--text-secondary);text-decoration:none;border-radius:8px;font-size:13px;font-weight:500;border:1px solid var(--border-color);transition:all .15s ease;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px)}
.q svg,.q img{width:16px;height:16px;flex-shrink:0;transition:all .15s ease}
.q svg{fill:currentColor;opacity:.6}
.q img{opacity:.7;border-radius:3px}
.q:hover{background:var(--bg-card-hover);color:var(--text-primary);border-color:var(--border-hover)}
.q:hover svg{opacity:.85}
.q:hover img{opacity:1}
.edit-btn{position:fixed;bottom:20px;right:20px;width:32px;height:32px;background:var(--bg-card);border:1px solid var(--border-color);border-radius:8px;color:var(--text-muted);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;padding:0;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px)}
.edit-btn:hover{background:var(--bg-card-hover);color:var(--text-secondary);border-color:var(--border-hover)}
.edit-btn svg{width:16px;height:16px}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);z-index:100;align-items:center;justify-content:center}
.modal.show{display:flex}
.modal-content{background:#1e2030;border-radius:16px;padding:24px;width:90%;max-width:520px;max-height:80vh;overflow-y:auto;border:1px solid rgba(255,255,255,.1)}
.modal h2{color:#fff;font-size:18px;font-weight:500;margin-bottom:20px}
.modal label{display:block;color:rgba(255,255,255,.6);font-size:12px;margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px}
.modal input[type="text"]{width:100%;padding:12px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);border-radius:8px;color:#fff;font-size:14px;margin-bottom:16px;outline:none}
.modal input[type="text"]:focus{border-color:rgba(255,255,255,.3)}
.modal-section{margin-bottom:20px}
.link-item{display:flex;gap:8px;margin-bottom:12px;align-items:flex-start;padding:12px;background:rgba(255,255,255,.03);border-radius:10px;border:1px solid rgba(255,255,255,.06)}
.link-icon{width:40px;height:40px;border-radius:8px;background:rgba(255,255,255,.08);display:flex;align-items:center;justify-content:center;cursor:pointer;overflow:hidden;flex-shrink:0;border:1px solid rgba(255,255,255,.1);transition:all .15s}
.link-icon:hover{background:rgba(255,255,255,.12);border-color:rgba(255,255,255,.2)}
.link-icon svg{width:20px;height:20px;fill:rgba(255,255,255,.4)}
.link-icon img{width:100%;height:100%;object-fit:cover}
.link-fields{flex:1;display:flex;flex-direction:column;gap:6px}
.link-fields input{margin-bottom:0!important;padding:8px 10px!important;font-size:13px!important}
.link-remove{padding:8px;background:rgba(255,100,100,.15);border:none;border-radius:6px;color:#ff6b6b;cursor:pointer;font-size:14px;line-height:1;align-self:flex-start}
.link-remove:hover{background:rgba(255,100,100,.25)}
.icon-hint{font-size:10px;color:rgba(255,255,255,.3);text-align:center;margin-top:4px}
.btn{padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;transition:all .15s}
.btn-primary{background:rgba(100,150,255,.3);color:#fff}
.btn-primary:hover{background:rgba(100,150,255,.4)}
.btn-secondary{background:rgba(255,255,255,.1);color:rgba(255,255,255,.7)}
.btn-secondary:hover{background:rgba(255,255,255,.15)}
.btn-row{display:flex;gap:10px;justify-content:flex-end;margin-top:20px}
.add-link{padding:10px 16px;background:rgba(100,255,150,.12);border:none;border-radius:8px;color:#7d7;cursor:pointer;font-size:13px;margin-bottom:16px;width:100%}
.add-link:hover{background:rgba(100,255,150,.2)}
input[type="file"]{display:none}
.bg-presets{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
.bg-swatch{width:48px;height:32px;border-radius:6px;cursor:pointer;border:2px solid transparent;transition:all .15s}
.bg-swatch:hover{transform:scale(1.05)}
.bg-swatch.active{border-color:#fff}
.bg-custom{display:flex;gap:8px;align-items:center}
.bg-upload{flex:1;padding:10px 16px;background:rgba(255,255,255,.08);border:1px dashed rgba(255,255,255,.2);border-radius:8px;color:rgba(255,255,255,.5);cursor:pointer;font-size:13px;text-align:center;transition:all .15s}
.bg-upload:hover{background:rgba(255,255,255,.12);border-color:rgba(255,255,255,.3)}
.bg-clear{padding:10px 12px;background:rgba(255,100,100,.15);border:none;border-radius:8px;color:#ff6b6b;cursor:pointer;font-size:12px}
.bg-clear:hover{background:rgba(255,100,100,.25)}
.bg-preview{width:60px;height:40px;border-radius:6px;background-size:cover;background-position:center;border:1px solid rgba(255,255,255,.2)}
.bg-gradient-maker{display:flex;gap:8px;align-items:center;margin-bottom:12px;padding:10px;background:rgba(255,255,255,.03);border-radius:8px}
.bg-gradient-maker label{font-size:11px;color:rgba(255,255,255,.4);margin:0;text-transform:none}
.color-picker{display:flex;flex-direction:column;align-items:center;gap:4px}
.color-picker input{width:36px;height:28px;border:none;border-radius:4px;cursor:pointer;background:none;padding:0}
.color-picker input::-webkit-color-swatch-wrapper{padding:0}
.color-picker input::-webkit-color-swatch{border-radius:4px;border:1px solid rgba(255,255,255,.2)}
.gradient-preview{flex:1;height:28px;border-radius:4px;border:1px solid rgba(255,255,255,.1)}
.gradient-apply{padding:6px 12px;background:rgba(100,150,255,.25);border:none;border-radius:6px;color:#fff;cursor:pointer;font-size:12px}
.gradient-apply:hover{background:rgba(100,150,255,.35)}
.theme-toggle{display:flex;gap:0;margin-top:8px;background:rgba(255,255,255,.06);border-radius:12px;padding:4px;border:1px solid rgba(255,255,255,.08)}
.theme-btn{flex:1;padding:14px 16px;border:none;border-radius:9px;cursor:pointer;font-size:13px;font-weight:500;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:10px;background:transparent;color:rgba(255,255,255,.5)}
.theme-btn svg{width:20px;height:20px;transition:transform .2s}
.theme-btn:hover{color:rgba(255,255,255,.7)}
.theme-btn:hover svg{transform:scale(1.1)}
.theme-btn.active{background:rgba(255,255,255,.12);color:#fff;box-shadow:0 2px 8px rgba(0,0,0,.2)}
.theme-btn.active.dark{background:linear-gradient(135deg,#2a2a3a,#1a1a2e)}
.theme-btn.active.light{background:linear-gradient(135deg,#f8f8fa,#e8e8ec);color:#222}
.theme-preview{width:28px;height:20px;border-radius:4px;flex-shrink:0}
.theme-btn.dark .theme-preview{background:linear-gradient(135deg,#1a1a2e,#0f3460);border:1px solid rgba(255,255,255,.2)}
.theme-btn.light .theme-preview{background:linear-gradient(135deg,#f0f0f2,#fff);border:1px solid rgba(0,0,0,.15)}
</style>
</head>
<body>
<div class="c">
<div class="g" id="g">Good afternoon</div>
<div class="t" id="t">12<span class="ts">:</span>00</div>
<div class="dt" id="d">Wednesday, January 28</div>
<div class="sc" id="sc">
<input type="text" class="si" id="s" placeholder="Search Google or your history..." autocomplete="off">
<div class="sg" id="r"></div>
</div>
<div class="ql" id="ql"></div>
</div>
<button class="edit-btn" id="edit-btn" onclick="openModal()" title="Customize">
<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
</button>

<div class="modal" id="modal">
<div class="modal-content">
<h2>Customize Start Page</h2>
<div class="modal-section">
<label>Your Name</label>
<input type="text" id="edit-name" placeholder="Enter your name">
</div>
<div class="modal-section">
<label>Background</label>
<div class="bg-presets" id="bg-presets"></div>
<div class="bg-gradient-maker">
<div class="color-picker">
<input type="color" id="color1" value="#1a1a2e" onchange="updateGradientPreview()">
<label>Start</label>
</div>
<div class="gradient-preview" id="gradient-preview"></div>
<div class="color-picker">
<input type="color" id="color2" value="#0f3460" onchange="updateGradientPreview()">
<label>End</label>
</div>
<button class="gradient-apply" onclick="applyCustomGradient()">Apply</button>
</div>
<div class="bg-custom">
<div class="bg-upload" onclick="document.getElementById('bg-file').click()">Upload image...</div>
<input type="file" id="bg-file" accept="image/*" onchange="handleBgUpload(this)">
<button class="bg-clear" onclick="clearBg()">Reset</button>
</div>
<label style="margin-top:12px">UI Style</label>
<div class="theme-toggle">
<button class="theme-btn dark" id="theme-dark" onclick="setTheme('dark')">
<div class="theme-preview"></div>
<span>Dark</span>
</button>
<button class="theme-btn light" id="theme-light" onclick="setTheme('light')">
<div class="theme-preview"></div>
<span>Light</span>
</button>
</div>
</div>
<div class="modal-section">
<label>Quick Links</label>
<div id="links-container"></div>
<button class="add-link" onclick="addLink()">+ Add Link</button>
</div>
<div class="btn-row">
<button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
<button class="btn btn-primary" onclick="saveSettings()">Save</button>
</div>
</div>
</div>

<script>
var darkTheme={
'--text-primary':'rgba(255,255,255,.9)',
'--text-secondary':'rgba(255,255,255,.7)',
'--text-muted':'rgba(255,255,255,.5)',
'--text-greeting':'rgba(255,255,255,.8)',
'--text-time':'#fff',
'--text-date':'rgba(255,255,255,.5)',
'--bg-card':'rgba(0,0,0,.3)',
'--bg-card-hover':'rgba(255,255,255,.1)',
'--border-color':'rgba(255,255,255,.15)',
'--border-hover':'rgba(255,255,255,.25)'
};
var lightTheme={
'--text-primary':'rgba(0,0,0,.85)',
'--text-secondary':'rgba(0,0,0,.7)',
'--text-muted':'rgba(0,0,0,.5)',
'--text-greeting':'rgba(0,0,0,.7)',
'--text-time':'rgba(0,0,0,.85)',
'--text-date':'rgba(0,0,0,.5)',
'--bg-card':'rgba(255,255,255,.75)',
'--bg-card-hover':'rgba(0,0,0,.08)',
'--border-color':'rgba(0,0,0,.12)',
'--border-hover':'rgba(0,0,0,.2)'
};

var defaultIcon='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z';
var defaultLinks=[
{name:'Mail',url:'https://mail.google.com',icon:'M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z'},
{name:'Calendar',url:'https://calendar.google.com',icon:'M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z'},
{name:'Drive',url:'https://drive.google.com',icon:'M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z'},
{name:'GitHub',url:'https://github.com',icon:'M12 0C5.37 0 0 5.37 0 12c0 5.3 3.44 9.8 8.21 11.39.6.11.79-.26.79-.58v-2.23c-3.34.73-4.03-1.42-4.03-1.42-.55-1.39-1.33-1.76-1.33-1.76-1.09-.74.08-.73.08-.73 1.2.08 1.84 1.24 1.84 1.24 1.07 1.83 2.81 1.3 3.49 1 .11-.78.42-1.3.76-1.6-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.12-.3-.54-1.52.12-3.18 0 0 1.01-.32 3.3 1.23.96-.27 1.98-.4 3-.4s2.04.13 3 .4c2.29-1.55 3.3-1.23 3.3-1.23.66 1.66.24 2.88.12 3.18.77.84 1.24 1.91 1.24 3.22 0 4.61-2.81 5.62-5.48 5.92.43.37.82 1.1.82 2.22v3.29c0 .32.19.69.8.58C20.57 21.8 24 17.3 24 12c0-6.63-5.37-12-12-12z'}
];
var gradients=[
{name:'Midnight',value:'linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%)'},
{name:'Ocean',value:'linear-gradient(135deg,#0f2027 0%,#203a43 50%,#2c5364 100%)'},
{name:'Sunset',value:'linear-gradient(135deg,#232526 0%,#414345 50%,#232526 100%)'},
{name:'Purple',value:'linear-gradient(135deg,#1a1a2e 0%,#2d1b4e 50%,#1a1a2e 100%)'},
{name:'Forest',value:'linear-gradient(135deg,#0d1b0e 0%,#1a3a1c 50%,#0d1b0e 100%)'},
{name:'Warm',value:'linear-gradient(135deg,#2c1810 0%,#3d2317 50%,#1a0f0a 100%)'},
{name:'Nord',value:'linear-gradient(135deg,#2e3440 0%,#3b4252 50%,#2e3440 100%)'},
{name:'Rose',value:'linear-gradient(135deg,#1a1a2e 0%,#2e1a2e 50%,#1a1a2e 100%)'}
];

function getSettings(){
var s=localStorage.getItem('startpage');
if(s){try{var p=JSON.parse(s);if(!p.theme)p.theme='dark';return p;}catch(e){}}
return {name:'',links:defaultLinks,bg:gradients[0].value,theme:'dark'};
}
function saveToStorage(settings){localStorage.setItem('startpage',JSON.stringify(settings));}

var settings=getSettings();
var g=document.getElementById('g'),t=document.getElementById('t'),d=document.getElementById('d'),s=document.getElementById('s'),r=document.getElementById('r'),ql=document.getElementById('ql'),S='http://127.0.0.1:18765',D,I=-1,W=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],M=['January','February','March','April','May','June','July','August','September','October','November','December'];

function applyTheme(){
var theme=settings.theme==='light'?lightTheme:darkTheme;
var root=document.documentElement;
for(var k in theme){root.style.setProperty(k,theme[k]);}
}
function setTheme(theme){
settings.theme=theme;
applyTheme();
updateThemeButtons();
}
function updateThemeButtons(){
var dk=document.getElementById('theme-dark');
var lt=document.getElementById('theme-light');
if(dk&&lt){
dk.classList.toggle('active',settings.theme==='dark');
lt.classList.toggle('active',settings.theme==='light');
}
}
function applyBg(){
var bg=settings.bg||gradients[0].value;
if(bg.startsWith('data:')||bg.startsWith('http')){
document.body.style.background='url('+bg+') center/cover no-repeat fixed';
}else{
document.body.style.background=bg;
}
}

applyBg();
applyTheme();

function renderLinks(){
var h='';
settings.links.forEach(function(l){
if(l.image){
h+='<a href="'+l.url+'" class="q"><img src="'+l.image+'" alt="">'+l.name+'</a>';
}else{
h+='<a href="'+l.url+'" class="q"><svg viewBox="0 0 24 24"><path d="'+(l.icon||defaultIcon)+'"/></svg>'+l.name+'</a>';
}
});
ql.innerHTML=h;
}

function u(){var n=new Date(),h=n.getHours(),H=(h%12)||12,m=n.getMinutes();
t.innerHTML=H+'<span class="ts">:</span>'+(m<10?'0':'')+m;
var greeting=(h>=5&&h<12?'Good morning':h>=12&&h<17?'Good afternoon':h>=17&&h<21?'Good evening':'Good night');
g.textContent=settings.name?greeting+', '+settings.name:greeting;
d.textContent=W[n.getDay()]+', '+M[n.getMonth()]+' '+n.getDate();}

renderLinks();u();setInterval(u,1000);s.focus();

function R(a,q){if(!q){r.innerHTML='';r.classList.remove('a');return;}
var h='<a href="https://www.google.com/search?q='+encodeURIComponent(q)+'" class="su sug"><svg class="sui" viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27A6.47 6.47 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg><span class="sut">Search Google for "'+q.replace(/</g,'&lt;')+'"</span><span class="suy">Google</span></a>';
for(var i=0;i<a.length;i++){var x=a[i],l=x.type==='bookmark'?'Saved':'History',v=x.visit_count||0,c=x.type==='bookmark'?'<svg class="sui" viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg>':'<svg class="sui" viewBox="0 0 24 24" fill="currentColor"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.95 8.95 0 0013 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg>';
h+='<a href="'+x.url+'" class="su">'+c+'<span class="sut">'+(x.title||'').replace(/</g,'&lt;').replace(/>/g,'&gt;')+'</span><span class="suy">'+l+'</span>'+(v>1?'<span class="suv">'+v+'×</span>':'')+'</a>';}
r.innerHTML=h;r.classList.add('a');I=-1;}

s.oninput=function(e){var q=e.target.value.trim();clearTimeout(D);if(!q){R([],'');return;}
D=setTimeout(function(){fetch(S+'/search?q='+encodeURIComponent(q),{signal:AbortSignal.timeout(2000)}).then(function(x){return x.ok?x.json():[];}).catch(function(){return[];}).then(function(a){R(a,q);});},300);};

s.onkeydown=function(e){var a=r.querySelectorAll('.su');
if(e.key==='ArrowDown'){e.preventDefault();I=Math.min(I+1,a.length-1);for(var i=0;i<a.length;i++)a[i].classList.toggle('sl',i===I);}
else if(e.key==='ArrowUp'){e.preventDefault();I=Math.max(I-1,-1);for(var i=0;i<a.length;i++)a[i].classList.toggle('sl',i===I);}
else if(e.key==='Enter'){if(I>=0&&a[I])location.href=a[I].href;else if(s.value.trim()){var v=s.value.trim();if(/^https?:\/\//i.test(v))location.href=v;else if(/^[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z]{2,})+/i.test(v))location.href='https://'+v;else location.href='https://www.google.com/search?q='+encodeURIComponent(v);}}
else if(e.key==='Escape'){r.classList.remove('a');I=-1;}};

document.onclick=function(e){if(!e.target.closest('.sc')&&!e.target.closest('.modal'))r.classList.remove('a');};
document.onkeydown=function(e){
if(e.key==='Escape'&&document.getElementById('modal').classList.contains('show')){closeModal();return;}
if(e.key.length===1&&!e.metaKey&&!e.ctrlKey&&document.activeElement!==s&&!document.getElementById('modal').classList.contains('show'))s.focus();
};

function openModal(){
document.getElementById('modal').classList.add('show');
document.getElementById('edit-name').value=settings.name||'';
renderBgPresets();
updateThemeButtons();
renderLinkEditor();
}
function closeModal(){
document.getElementById('modal').classList.remove('show');
s.focus();
}
function renderBgPresets(){
var c=document.getElementById('bg-presets');
var h='';
gradients.forEach(function(gr,i){
var active=(settings.bg===gr.value)?'active':'';
h+='<div class="bg-swatch '+active+'" style="background:'+gr.value+'" onclick="selectGradient('+i+')" title="'+gr.name+'"></div>';
});
if(settings.bg&&settings.bg.startsWith('data:')){
h+='<div class="bg-preview" style="background-image:url('+settings.bg+')"></div>';
}
c.innerHTML=h;
updateGradientPreview();
}
function updateGradientPreview(){
var c1=document.getElementById('color1');
var c2=document.getElementById('color2');
var preview=document.getElementById('gradient-preview');
if(c1&&c2&&preview){
preview.style.background='linear-gradient(135deg,'+c1.value+' 0%,'+c2.value+' 100%)';
}
}
function applyCustomGradient(){
var c1=document.getElementById('color1').value;
var c2=document.getElementById('color2').value;
settings.bg='linear-gradient(135deg,'+c1+' 0%,'+c2+' 100%)';
applyBg();
renderBgPresets();
}
function selectGradient(i){
settings.bg=gradients[i].value;
applyBg();
renderBgPresets();
}
function handleBgUpload(input){
var file=input.files[0];
if(!file)return;
if(file.size>2000000){alert('Image too large. Please use an image under 2MB.');return;}
var reader=new FileReader();
reader.onload=function(e){
settings.bg=e.target.result;
applyBg();
renderBgPresets();
};
reader.readAsDataURL(file);
}
function clearBg(){
settings.bg=gradients[0].value;
applyBg();
renderBgPresets();
}
function renderLinkEditor(){
var c=document.getElementById('links-container');
var h='';
settings.links.forEach(function(l,i){
var iconPreview=l.image?
'<img src="'+l.image+'" alt="">':
'<svg viewBox="0 0 24 24"><path d="'+(l.icon||defaultIcon)+'"/></svg>';
h+='<div class="link-item">'+
'<div>'+
'<div class="link-icon" onclick="triggerUpload('+i+')" title="Click to upload icon">'+iconPreview+'</div>'+
'<div class="icon-hint">Click to change</div>'+
'</div>'+
'<input type="file" id="file-'+i+'" accept="image/*" onchange="handleUpload('+i+',this)">'+
'<div class="link-fields">'+
'<input type="text" value="'+escapeHtml(l.name)+'" placeholder="Name" onchange="updateLink('+i+',\'name\',this.value)">'+
'<input type="text" value="'+escapeHtml(l.url)+'" placeholder="URL" onchange="updateLink('+i+',\'url\',this.value)">'+
'</div>'+
'<button class="link-remove" onclick="removeLink('+i+')" title="Remove">×</button>'+
'</div>';
});
c.innerHTML=h;
}
function escapeHtml(str){return (str||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function triggerUpload(i){document.getElementById('file-'+i).click();}
function handleUpload(i,input){
var file=input.files[0];
if(!file)return;
if(file.size>500000){alert('Image too large. Please use an image under 500KB.');return;}
var reader=new FileReader();
reader.onload=function(e){
settings.links[i].image=e.target.result;
delete settings.links[i].icon;
renderLinkEditor();
};
reader.readAsDataURL(file);
}
function updateLink(i,field,value){settings.links[i][field]=value;}
function removeLink(i){settings.links.splice(i,1);renderLinkEditor();}
function addLink(){
settings.links.push({name:'New',url:'https://',icon:defaultIcon});
renderLinkEditor();
}
function saveSettings(){
settings.name=document.getElementById('edit-name').value.trim();
saveToStorage(settings);
renderLinks();
u();
closeModal();
}
</script>
</body>
</html>
